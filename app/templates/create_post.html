{% extends "base.html" %}
{% block content %}
<div class="card shadow-sm">
    <div class="card-header bg-dark text-white">
        <h3 class="mb-0"><i class="fas fa-plus-circle"></i> {{ legend }}</h3>
    </div>
    <div class="card-body">
        <form method="POST" action="" enctype="multipart/form-data">
            {{ form.hidden_tag() }}

            <!-- Post Type Selection -->
            <div class="row mb-4">
                <div class="col-md-4">
                    <div class="form-group">
                        {{ form.post_type.label(class="form-control-label font-weight-bold") }}
                        {{ form.post_type(class="form-control form-control-lg") }}
                        <small class="form-text text-muted">Select the type of action plan.</small>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="form-group">
                        {{ form.project_area.label(class="form-control-label font-weight-bold") }}
                        {{ form.project_area(class="form-control form-control-lg", placeholder="e.g., Assembly / Main
                        Line") }}
                        <small class="form-text text-muted">Project and area (optional).</small>
                    </div>
                </div>
            </div>

            <hr class="my-4">

            <!-- Problem & Cause Section -->
            <div class="row">
                <div class="col-md-6">
                    <div class="form-group">
                        {{ form.problem.label(class="form-control-label font-weight-bold") }}
                        {{ form.problem(class="form-control form-control-lg" + (" is-invalid" if form.problem.errors
                        else ""), placeholder="Describe the problem or opportunity") }}
                        {% if form.problem.errors %}
                        <div class="invalid-feedback">
                            {% for error in form.problem.errors %}<span>{{ error }}</span>{% endfor %}
                        </div>
                        {% endif %}
                    </div>

                    <div class="form-group">
                        {{ form.cause.label(class="form-control-label font-weight-bold") }}
                        {{ form.cause(class="form-control form-control-lg" + (" is-invalid" if form.cause.errors else
                        ""), placeholder="Root cause analysis") }}
                        {% if form.cause.errors %}
                        <div class="invalid-feedback">
                            {% for error in form.cause.errors %}<span>{{ error }}</span>{% endfor %}
                        </div>
                        {% endif %}
                    </div>

                    <div class="form-group">
                        <label class="form-control-label font-weight-bold"><i class="fas fa-camera text-warning"></i>
                            Problem/Opportunity Image</label>
                        {{ form.image_problem(class="form-control-file") }}
                        {% if form.image_problem.errors %}
                        {% for error in form.image_problem.errors %}
                        <div class="text-danger">{{ error }}</div>
                        {% endfor %}
                        {% endif %}
                        <small class="form-text text-muted">Upload image showing the problem.</small>
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="form-group">
                        {{ form.corrective_action.label(class="form-control-label font-weight-bold") }}
                        {{ form.corrective_action(class="form-control form-control-lg" + (" is-invalid" if
                        form.corrective_action.errors else ""), placeholder="Action to resolve the issue") }}
                        {% if form.corrective_action.errors %}
                        <div class="invalid-feedback">
                            {% for error in form.corrective_action.errors %}<span>{{ error }}</span>{% endfor %}
                        </div>
                        {% endif %}
                    </div>

                    <div class="form-group">
                        {{ form.responsible.label(class="form-control-label font-weight-bold") }}
                        {{ form.responsible(class="form-control form-control-lg" + (" is-invalid" if
                        form.responsible.errors else ""), placeholder="Person responsible") }}
                        {% if form.responsible.errors %}
                        <div class="invalid-feedback">
                            {% for error in form.responsible.errors %}<span>{{ error }}</span>{% endfor %}
                        </div>
                        {% endif %}
                    </div>

                    <div class="form-group">
                        <label class="form-control-label font-weight-bold"><i class="fas fa-camera text-success"></i>
                            Corrective Action Image</label>
                        {{ form.image_corrective(class="form-control-file") }}
                        {% if form.image_corrective.errors %}
                        {% for error in form.image_corrective.errors %}
                        <div class="text-danger">{{ error }}</div>
                        {% endfor %}
                        {% endif %}
                        <small class="form-text text-muted">Upload image showing the corrective action.</small>
                    </div>
                </div>
            </div>

            <hr class="my-4">

            <!-- Dates & Status Section -->
            <div class="row">
                <div class="col-md-3">
                    <div class="form-group">
                        {{ form.audit_date.label(class="form-control-label font-weight-bold") }}
                        {{ form.audit_date(class="form-control form-control-lg", type="date") }}
                        <small class="form-text text-muted">When the audit occurred.</small>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="form-group">
                        {{ form.audit_type.label(class="form-control-label font-weight-bold") }}
                        {{ form.audit_type(class="form-control form-control-lg") }}
                        <small class="form-text text-muted">Type of audit performed.</small>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="form-group">
                        {{ form.date_realization.label(class="form-control-label font-weight-bold") }}
                        {{ form.date_realization(class="form-control form-control-lg", type="date") }}
                        {% if form.date_realization.errors %}
                        <div class="text-danger">
                            {% for error in form.date_realization.errors %}<span>{{ error }}</span>{% endfor %}
                        </div>
                        {% endif %}
                        <small class="form-text text-muted">Target completion date.</small>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="form-group">
                        {{ form.status.label(class="form-control-label font-weight-bold") }}
                        {{ form.status(class="form-control form-control-lg") }}
                        <small class="form-text text-muted">Current status.</small>
                    </div>
                </div>
            </div>

            <div class="form-group text-center mt-4">
                {{ form.submit(class="btn btn-primary btn-lg px-5") }}
                <a href="{{ url_for('home') }}" class="btn btn-outline-secondary btn-lg px-4">Cancel</a>
            </div>
        </form>
    </div>
</div>
{% endblock content %}